<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
<!--
  hive-site.xml — Configuration Apache Hive
  Metastore embarqué Derby | Exécution via Tez (sans pre-warming)
-->
<configuration>

  <!-- ── Metastore Derby embarqué ──────────────────────────── -->
  <property>
    <name>javax.jdo.option.ConnectionURL</name>
    <value>jdbc:derby:;databaseName=/opt/hive/metastore_db;create=true</value>
  </property>
  <property>
    <name>javax.jdo.option.ConnectionDriverName</name>
    <value>org.apache.derby.jdbc.EmbeddedDriver</value>
  </property>
  <property>
    <name>javax.jdo.option.ConnectionUserName</name>
    <value>APP</value>
  </property>
  <property>
    <name>javax.jdo.option.ConnectionPassword</name>
    <value>mine</value>
  </property>

  <!-- Adresse du Metastore Thrift -->
  <property>
    <name>hive.metastore.uris</name>
    <value>thrift://localhost:9083</value>
  </property>

  <!-- ── Warehouse HDFS ─────────────────────────────────────── -->
  <property>
    <name>hive.metastore.warehouse.dir</name>
    <value>/user/hive/warehouse</value>
  </property>

  <!-- ── Moteur d'exécution : Tez ──────────────────────────── -->
  <property>
    <name>hive.execution.engine</name>
    <value>tez</value>
  </property>

  <!-- ── Désactiver le pre-warming des sessions Tez ────────────
       Par défaut Hive pré-initialise N sessions Tez au démarrage,
       ce qui bloque HiveServer2 si YARN/Tez n'est pas encore stable.
       On désactive pour un cluster mono-nœud de cours. -->
  <property>
    <name>hive.server2.tez.initialize.default.sessions</name>
    <value>false</value>
  </property>
  <property>
    <name>hive.server2.tez.sessions.per.default.queue</name>
    <value>0</value>
  </property>

  <!-- ── HiveServer2 ────────────────────────────────────────── -->
  <property>
    <name>hive.server2.thrift.port</name>
    <value>10000</value>
  </property>
  <property>
    <name>hive.server2.thrift.bind.host</name>
    <value>0.0.0.0</value>
  </property>
  <property>
    <name>hive.server2.authentication</name>
    <value>NONE</value>
  </property>

  <!-- Désactiver le logging des opérations (plus léger en cours) -->
  <property>
    <name>hive.server2.logging.operation.enabled</name>
    <value>false</value>
  </property>

  <!-- ── Optimisations ─────────────────────────────────────── -->
  <property>
    <name>hive.stats.autogather</name>
    <value>true</value>
  </property>
  <property>
    <name>hive.vectorized.execution.enabled</name>
    <value>true</value>
  </property>

</configuration>
