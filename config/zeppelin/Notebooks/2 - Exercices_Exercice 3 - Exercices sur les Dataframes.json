{"paragraphs":[{"text":"%md\n###Bienvenue dans ce quatrième exercice\n\nDans cet exercice, nous allons manipuler des Dataframes à partir des données de position AIS.\nL'objectif va être de manipuler ces structures de données proches des bases relationnelles en calculant quelques statistiques... et plus !\n\n####C'est parti !","dateUpdated":"2020-10-05T10:57:34+0000","config":{"editorSetting":{},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Bienvenue dans ce quatrième exercice</h3>\n<p>Dans cet exercice, nous allons manipuler des Dataframes à partir des données de position AIS.\n<br  />L'objectif va être de manipuler ces structures de données proches des bases relationnelles en calculant quelques statistiques&hellip; et plus !</p>\n<h4>C'est parti !</h4>\n"}]},"apps":[],"jobName":"paragraph_1601895454668_1658095947","id":"20161212-230953_439826209","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:38379"},{"text":"%md\n\n### Les fonctions dont vous aurez besoin dans cet exercice :\nPour charger un fichier parquet  dans un Dataframe\n`spark.read.parquet('cheminDuFichier')`\n\nPour afficher les types de données d'un Dataframe :\n`df.dtypes`\n\nPour afficher le schema d'un Dataframe :\n`df.schema`\n\nPour trier un Dataframe:\n`df.sort`\n\nPour sélectionner une colonne d'un Dataframe :\n`df.nomColonne`\n\nPour obtenir une colonne triée dans l'ordre décroissant :\n`df.nomColonne.desc()`\n\nPour afficher un dataframe sous forme de table\n`df.show()`\n\n\n#### Des questions sur la syntaxe Python ? [Cliquez-ici](https://docs.python.org/3.4/contents.html)\n#### Des questions sur une fonction Spark ? [Cliquez-là](https://spark.apache.org/docs/2.0.0/api/python/index.html)","dateUpdated":"2020-10-05T10:57:34+0000","config":{"editorSetting":{},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Les fonctions dont vous aurez besoin dans cet exercice :</h3>\n<p>Pour charger un fichier parquet  dans un Dataframe\n<br  /><code>spark.read.parquet('cheminDuFichier')</code></p>\n<p>Pour afficher les types de données d'un Dataframe :\n<br  /><code>df.dtypes</code></p>\n<p>Pour afficher le schema d'un Dataframe :\n<br  /><code>df.schema</code></p>\n<p>Pour trier un Dataframe:\n<br  /><code>df.sort</code></p>\n<p>Pour sélectionner une colonne d'un Dataframe :\n<br  /><code>df.nomColonne</code></p>\n<p>Pour obtenir une colonne triée dans l'ordre décroissant :\n<br  /><code>df.nomColonne.desc()</code></p>\n<p>Pour afficher un dataframe sous forme de table\n<br  /><code>df.show()</code></p>\n<h4>Des questions sur la syntaxe Python ? <a href=\"https://docs.python.org/3.4/contents.html\">Cliquez-ici</a></h4>\n<h4>Des questions sur une fonction Spark ? <a href=\"https://spark.apache.org/docs/2.0.0/api/python/index.html\">Cliquez-là</a></h4>\n"}]},"apps":[],"jobName":"paragraph_1601895454668_1658095947","id":"20161212-231612_571802878","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38380"},{"text":"%pyspark\nfrom pyspark.sql.functions import *\n# On charge les fichiers de position de bateaux \n# Les fichiers sont au format parquet, il faut utiliser la fonction spark.read.parquet()\n# Les données seront ainsi directement chargées dans un Dataframe, au lieu d'un RDD\n# Il est possible de récupérer un ou plusieurs fichiers en complétant avec des ? ou *\n\n#Q1 - Chargez le fichier *1757*.parq dans un Dataframe du nom de \"position\"\nposition = spark.read.parquet(\"/data/data/position/*.parq\")","dateUpdated":"2020-10-05T10:57:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":[],"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1601895454669_1657711198","id":"20161121-125346_1817127433","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38381"},{"text":"%pyspark\n# Q2 - Afficher le nombre d'éléments du DF\nprint(\"Nombre de lignes :\\n\", position.count())\n\n# Q2 - bis On affiche le type des données\nprint(\"Type des données:\\n\",position.dtypes)\n\n# Q2 -ter  On affiche le schema des données\nprint(\"Schéma du DF:\\n\",position.schema)","dateUpdated":"2020-10-05T10:57:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Nombre de lignes :\n 320384\nType des données:\n [('id_vessel', 'bigint'), ('mmsi', 'bigint'), ('type', 'int'), ('lat', 'double'), ('lon', 'double'), ('timestamp_pos', 'bigint'), ('speed', 'double'), ('heading', 'int'), ('payload', 'binary')]\nSchéma du DF:\n StructType(List(StructField(id_vessel,LongType,true),StructField(mmsi,LongType,true),StructField(type,IntegerType,true),StructField(lat,DoubleType,true),StructField(lon,DoubleType,true),StructField(timestamp_pos,LongType,true),StructField(speed,DoubleType,true),StructField(heading,IntegerType,true),StructField(payload,BinaryType,true)))\n"}]},"apps":[],"jobName":"paragraph_1601895454669_1657711198","id":"20161206-095613_490390415","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38382"},{"text":"%pyspark\n# Q3 - Créer le DF bateaux, à partir du DF position, trié par vitesse\nbateaux = position.sort(col(\"speed\").desc())\nbateaux = position.sort(position.speed.desc())\nbateaux = position.sort(desc(\"speed\"))\n\n# On affiche le dataframe\nbateaux.show()\n","dateUpdated":"2020-10-05T10:57:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+---------+----+-------------------+-------------------+-------------+-----+-------+--------------------+\n|id_vessel|     mmsi|type|                lat|                lon|timestamp_pos|speed|heading|             payload|\n+---------+---------+----+-------------------+-------------------+-------------+-----+-------+--------------------+\n|    61624|566416000|  71| 35.814391666666666|           -5.65548|1414969396000|102.2|     44|[5C 73 3A 72 4F 5...|\n|   180073|111219503|  51| 56.878903333333334| 11.693968333333334|1414970980000|102.2|   null|[5C 73 3A 72 4F 5...|\n|    61624|566416000|  71|  35.83620666666667|-5.6108183333333335|1414972115000|102.2|     43|[5C 73 3A 72 4F 5...|\n|    61624|566416000|  71| 35.781666666666666|          -5.722465|1414970864000|102.2|     44|[5C 73 3A 72 4F 5...|\n|   180073|111219503|  51|  56.93767833333333|            11.1784|1414969498000|102.2|   null|[5C 73 3A 72 4F 5...|\n|    61624|566416000|  71| 35.801406666666665| -5.682078333333333|1414970141000|102.2|     44|[5C 73 3A 72 4F 5...|\n|   180073|111219503|  51|  57.05113333333333|          10.196775|1414972421000|102.2|   null|[5C 73 3A 72 4F 5...|\n|   180073|111219503|  51|          56.968395|          10.952435|1414971701000|102.2|   null|[5C 73 3A 72 4F 5...|\n|    61624|566416000|  71|          35.850065|-5.5823616666666664|1414971618000|102.2|     43|[5C 73 3A 72 4F 5...|\n|    61624|566416000|  71|  35.84017166666667|          -5.602695|1414972349000|102.2|     43|[5C 73 3A 72 4F 5...|\n|  1709304|257484880|null|-18.502306666666666| 164.71381333333332|1414971478000| 99.7|    111|[5C 73 3A 72 4F 5...|\n|   308536|311026501|null|  51.97026666666667|             4.0782|1414969630000| 98.7|    267|[5C 73 3A 72 4F 5...|\n|   276661|226183002|null|            50.7239|            1.58355|1414970195000| 96.1|   null|[5C 73 3A 72 4F 5...|\n|   286894|244650722|  37|           51.87977|           4.443685|1414969710000| 96.0|   null|[5C 73 3A 72 4F 5...|\n|   609672|257465802|null|  64.90393833333333| 11.280513333333333|1414972547000| 96.0|   null|[5C 73 3A 72 4F 5...|\n|   609672|257465802|null|  64.90393833333333| 11.280513333333333|1414972547000| 96.0|   null|[5C 73 3A 72 4F 5...|\n|     2606|244770334|  90|  51.89976333333333|  4.494853333333333|1414972004000| 96.0|   null|[5C 73 3A 72 4F 5...|\n|   516639|251347108|null|          64.922315|         -23.810145|1414969344000| 96.0|    113|[5C 73 3A 72 4F 5...|\n|     2606|244770334|  90|  51.89976333333333|  4.494853333333333|1414972004000| 96.0|   null|[5C 73 3A 72 4F 5...|\n|   368731|335551083|null| 3.9459416666666667| 172.36143666666666|1414972173000| 88.4|    340|[5C 73 3A 72 4F 5...|\n+---------+---------+----+-------------------+-------------------+-------------+-----+-------+--------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1601895454669_1657711198","id":"20161121-125431_2074494877","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38383"},{"text":"%md\nOn peut rajouter des colonnes à un DataFrame avec la méthode df.withColumn()\nLa syntaxe de la commande est la suivante :\n`df.withColumn('nomDeMaColonne', valeur)`\n\nPar exemple si je veux ajouter une colonne contenant la vitesse du bateau + 10\n`df.withColumn('speedPlus10',df.speed+10)`\n","dateUpdated":"2020-10-05T10:57:34+0000","config":{"editorSetting":{},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>On peut rajouter des colonnes à un DataFrame avec la méthode df.withColumn()\n<br  />La syntaxe de la commande est la suivante :\n<br  /><code>df.withColumn('nomDeMaColonne', valeur)</code></p>\n<p>Par exemple si je veux ajouter une colonne contenant la vitesse du bateau + 10\n<br  /><code>df.withColumn('speedPlus10',df.speed+10)</code></p>\n"}]},"apps":[],"jobName":"paragraph_1601895454669_1657711198","id":"20161212-232904_1103893019","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38384"},{"text":"%pyspark\n# Q4 - Pour disposer d'une date plus lisible, rajoutez la colonne \"timestamp_readable\"\n# Pour cela, il vous faudra d'abord transformer le timestamp en secondes (timestamp_pos est en ms) puis le caster en timestamp avec la méthode cast()\nbateaux = bateaux.withColumn('timestamp_readable',(bateaux.timestamp_pos/1000).cast('timestamp'))\nbateaux.cache()\n\n# Affichez à nouveau le Dataframe\nbateaux.show()","dateUpdated":"2020-10-05T10:57:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+---------+----+-------------------+-------------------+-------------+-----+-------+--------------------+--------------------+\n|id_vessel|     mmsi|type|                lat|                lon|timestamp_pos|speed|heading|             payload|  timestamp_readable|\n+---------+---------+----+-------------------+-------------------+-------------+-----+-------+--------------------+--------------------+\n|    61624|566416000|  71|  35.84017166666667|          -5.602695|1414972349000|102.2|     43|[5C 73 3A 72 4F 5...|2014-11-02 23:52:...|\n|    61624|566416000|  71| 35.781666666666666|          -5.722465|1414970864000|102.2|     44|[5C 73 3A 72 4F 5...|2014-11-02 23:27:...|\n|    61624|566416000|  71| 35.814391666666666|           -5.65548|1414969396000|102.2|     44|[5C 73 3A 72 4F 5...|2014-11-02 23:03:...|\n|   180073|111219503|  51|  57.05113333333333|          10.196775|1414972421000|102.2|   null|[5C 73 3A 72 4F 5...|2014-11-02 23:53:...|\n|   180073|111219503|  51| 56.878903333333334| 11.693968333333334|1414970980000|102.2|   null|[5C 73 3A 72 4F 5...|2014-11-02 23:29:...|\n|    61624|566416000|  71|  35.83620666666667|-5.6108183333333335|1414972115000|102.2|     43|[5C 73 3A 72 4F 5...|2014-11-02 23:48:...|\n|   180073|111219503|  51|  56.93767833333333|            11.1784|1414969498000|102.2|   null|[5C 73 3A 72 4F 5...|2014-11-02 23:04:...|\n|    61624|566416000|  71| 35.801406666666665| -5.682078333333333|1414970141000|102.2|     44|[5C 73 3A 72 4F 5...|2014-11-02 23:15:...|\n|   180073|111219503|  51|          56.968395|          10.952435|1414971701000|102.2|   null|[5C 73 3A 72 4F 5...|2014-11-02 23:41:...|\n|    61624|566416000|  71|          35.850065|-5.5823616666666664|1414971618000|102.2|     43|[5C 73 3A 72 4F 5...|2014-11-02 23:40:...|\n|  1709304|257484880|null|-18.502306666666666| 164.71381333333332|1414971478000| 99.7|    111|[5C 73 3A 72 4F 5...|2014-11-02 23:37:...|\n|   308536|311026501|null|  51.97026666666667|             4.0782|1414969630000| 98.7|    267|[5C 73 3A 72 4F 5...|2014-11-02 23:07:...|\n|   276661|226183002|null|            50.7239|            1.58355|1414970195000| 96.1|   null|[5C 73 3A 72 4F 5...|2014-11-02 23:16:...|\n|   609672|257465802|null|  64.90393833333333| 11.280513333333333|1414972547000| 96.0|   null|[5C 73 3A 72 4F 5...|2014-11-02 23:55:...|\n|   286894|244650722|  37|           51.87977|           4.443685|1414969710000| 96.0|   null|[5C 73 3A 72 4F 5...|2014-11-02 23:08:...|\n|   516639|251347108|null|          64.922315|         -23.810145|1414969344000| 96.0|    113|[5C 73 3A 72 4F 5...|2014-11-02 23:02:...|\n|   609672|257465802|null|  64.90393833333333| 11.280513333333333|1414972547000| 96.0|   null|[5C 73 3A 72 4F 5...|2014-11-02 23:55:...|\n|     2606|244770334|  90|  51.89976333333333|  4.494853333333333|1414972004000| 96.0|   null|[5C 73 3A 72 4F 5...|2014-11-02 23:46:...|\n|     2606|244770334|  90|  51.89976333333333|  4.494853333333333|1414972004000| 96.0|   null|[5C 73 3A 72 4F 5...|2014-11-02 23:46:...|\n|   368731|335551083|null| 3.9459416666666667| 172.36143666666666|1414972173000| 88.4|    340|[5C 73 3A 72 4F 5...|2014-11-02 23:49:...|\n+---------+---------+----+-------------------+-------------------+-------------+-----+-------+--------------------+--------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1601895454669_1657711198","id":"20161212-232839_1404938104","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38385"},{"text":"%md\nIl est possible de créer un nouveau dataframe contenant des statistiques sur un dataframe donné\nPour cela, il suffit d'utiliser la méthode describe()\nExemple d'utilisation :\n`df.describe()`","dateUpdated":"2020-10-05T10:57:34+0000","config":{"editorSetting":{},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>Il est possible de créer un nouveau dataframe contenant des statistiques sur un dataframe donné\n<br  />Pour cela, il suffit d'utiliser la méthode describe()\n<br  />Exemple d'utilisation :\n<br  /><code>df.describe()</code></p>\n"}]},"apps":[],"jobName":"paragraph_1601895454669_1657711198","id":"20161212-233452_1791609919","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38386"},{"text":"%pyspark\n# Q5 - Affichez sous forme de table, les statistiques du dataframe bateaux\n# Astuce : describe() retourne un dataframe, et vous avez déjà affiché un dataframe sous forme de table plusieurs fois \nbateaux.describe().show()","dateUpdated":"2020-10-05T10:57:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+------------------+--------------------+------------------+------------------+-------------------+--------------------+-----------------+------------------+\n|summary|         id_vessel|                mmsi|              type|               lat|                lon|       timestamp_pos|            speed|           heading|\n+-------+------------------+--------------------+------------------+------------------+-------------------+--------------------+-----------------+------------------+\n|  count|            320384|              320384|            311843|            320142|             320142|              320384|           317567|            172062|\n|   mean| 86994.76085884438| 3.698734417078381E8| 61.72363978027405|30.540662582890292|  38.19681955291691|1.414975739808743...|3.015940573170375| 179.0795527193686|\n| stddev|117905.59618546451|1.3141735213266513E8|21.746220117914092|24.403615968250335|  80.21177501001434|1.8877346589264344E7|5.114368094495853|106.41867355871477|\n|    min|                 0|                   0|                 1|-85.94645166666666|-179.96609833333332|       1414969200000|              0.0|                 0|\n|    max|           1768420|          1073741823|               255|              90.0|              180.0|       1415055538000|            102.2|               359|\n+-------+------------------+--------------------+------------------+------------------+-------------------+--------------------+-----------------+------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1601895454670_1658865445","id":"20161206-095956_459687579","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38387"},{"text":"%md\nIl existe plusieurs méthodes pour filtrer un dataframe, mais toutes deux différentes du filtrage d'un RDD\nAvec un RDD on ferait :\n`rdd.filter(lamda row : row.field=\"maValeur\")`\n\nAvec un Dataframe on peut faire soit :\n`df.filter(\"field = maValeur\")`\n\nsoit\n`df.filter(df.field == \"maValeur\")`\n","dateUpdated":"2020-10-05T10:57:34+0000","config":{"editorSetting":{},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>Il existe plusieurs méthodes pour filtrer un dataframe, mais toutes deux différentes du filtrage d'un RDD\n<br  />Avec un RDD on ferait :\n<br  /><code>rdd.filter(lamda row : row.field=\"maValeur\")</code></p>\n<p>Avec un Dataframe on peut faire soit :\n<br  /><code>df.filter(\"field = maValeur\")</code></p>\n<p>soit\n<br  /><code>df.filter(df.field == \"maValeur\")</code></p>\n"}]},"apps":[],"jobName":"paragraph_1601895454670_1658865445","id":"20161212-233720_349871593","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38388"},{"text":"%pyspark\n# Q6 - Filtrer le dataframe bateaux sur un bateau en particulier...\n# Si vous manquez d'inspiration, prenez le id_vessel 28052\nmonBateau = bateaux.filter(bateaux.id_vessel == \"28052\")\n\nmonBateau.show()\n\n","dateUpdated":"2020-10-05T10:57:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+---------+----+------------------+------------------+-------------+-----+-------+--------------------+--------------------+\n|id_vessel|     mmsi|type|               lat|               lon|timestamp_pos|speed|heading|             payload|  timestamp_readable|\n+---------+---------+----+------------------+------------------+-------------+-----+-------+--------------------+--------------------+\n|    28052|345971158|  50|          18.43784|         -93.18951|1414971246000|  0.1|   null|[5C 73 3A 72 4F 5...|2014-11-02 23:34:...|\n|    28052|345971158|  50|         18.437855|        -93.189515|1414969600000|  0.0|   null|[5C 73 3A 72 4F 5...|2014-11-02 23:06:...|\n|    28052|345971158|  50| 18.43783833333333|-93.18950166666667|1414970417000|  0.0|   null|[5C 73 3A 72 4F 5...|2014-11-02 23:20:...|\n|    28052|345971158|  50|18.437841666666667|         -93.18951|1414972068000|  0.0|   null|[5C 73 3A 72 4F 5...|2014-11-02 23:47:...|\n+---------+---------+----+------------------+------------------+-------------+-----+-------+--------------------+--------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1601895454670_1658865445","id":"20161206-101243_1064897522","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38389"},{"text":"%md\nQuelques opérations qui peuvent vous être utiles :\n\nSélectionner une colonne d'un DF\n`df.select(\"nomColonne\")`\n\nIl est possible d'utiliser les fonctions min, max... lors d'un select\n`df.select(max(\"nomColonne\"))`\n\nRécupérer les valeurs distinctes\n`df.distinct()`\n\n","dateUpdated":"2020-10-05T10:57:34+0000","config":{"editorSetting":{},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>Quelques opérations qui peuvent vous être utiles :</p>\n<p>Sélectionner une colonne d'un DF\n<br  /><code>df.select(\"nomColonne\")</code></p>\n<p>Il est possible d'utiliser les fonctions min, max&hellip; lors d'un select\n<br  /><code>df.select(max(\"nomColonne\"))</code></p>\n<p>Récupérer les valeurs distinctes\n<br  /><code>df.distinct()</code></p>\n"}]},"apps":[],"jobName":"paragraph_1601895454670_1658865445","id":"20161212-234520_611913951","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38390"},{"text":"%pyspark\n# Quelques statistiques ...\n# Affichez sans persister dans un DF (et à partir du DF bateaux)\nfrom pyspark.sql.functions import *\n\n# Q7 -Le nombre de bateaux avec une vitesse == 0\nprint(bateaux.filter(bateaux.speed == 0).count())\n\n# Q7 bis - Le ratio de bateaux a l'arret / total de bateaux\nprint(bateaux.filter(bateaux.speed == 0).count() / bateaux.count())\n\n# Q7 ter - Les types distincts de bateaux\nprint(bateaux.select(bateaux.type).distinct().count())\n\n# Q8 - On affiche la moyenne de la vitesse des bateaux sans tenir compte des bateaux a l'arret\nprint(bateaux.filter(bateaux.speed>0).select(avg(bateaux.speed)).show())","dateUpdated":"2020-10-05T10:57:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"158552\n0.49488114262884536\n210\n+-----------------+\n|       avg(speed)|\n+-----------------+\n|6.023099707574734|\n+-----------------+\n\nNone\n"}]},"apps":[],"jobName":"paragraph_1601895454670_1658865445","id":"20161121-135047_627272583","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38391"},{"text":"%pyspark\n# Q9 - On affiche la date min puis  la date max de notre DF bateaux\nprint(bateaux.select(min(bateaux.timestamp_readable)).show())\nprint(bateaux.select(max(bateaux.timestamp_readable)).show())\n\n","dateUpdated":"2020-10-05T10:57:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------------------+\n|min(timestamp_readable)|\n+-----------------------+\n|   2014-11-02 23:00:...|\n+-----------------------+\n\nNone\n+-----------------------+\n|max(timestamp_readable)|\n+-----------------------+\n|   2014-11-03 22:58:...|\n+-----------------------+\n\nNone\n"}]},"apps":[],"jobName":"paragraph_1601895454670_1658865445","id":"20161201-160457_1497313179","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38392"},{"text":"%pyspark\n# Q10 - Créer un dataframe avec l'id, la vitesse et le timestamp readable\n# Astuce : la méthode select permet de sélectioner plusieurs colonnes\nspd = bateaux.select(bateaux.id_vessel, bateaux.speed, bateaux.timestamp_readable)\n\n# Afficher les 3 premières lignes\nspd.show(3)\n\n\n","dateUpdated":"2020-10-05T10:57:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+-----+--------------------+\n|id_vessel|speed|  timestamp_readable|\n+---------+-----+--------------------+\n|    61624|102.2|2014-11-02 23:52:...|\n|    61624|102.2|2014-11-02 23:27:...|\n|    61624|102.2|2014-11-02 23:03:...|\n+---------+-----+--------------------+\nonly showing top 3 rows\n\n"}]},"apps":[],"jobName":"paragraph_1601895454671_1658480696","id":"20161206-095252_762177672","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38393"},{"text":"%pyspark\n# Q11 - Ajouter une colonne boolean à True si le bateau est en mouvement\nspd = spd.withColumn('mouvement', spd.speed>0)\n\n# Afficher les 3 premières lignes\nspd.show(3)\n","dateUpdated":"2020-10-05T10:57:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+-----+--------------------+---------+\n|id_vessel|speed|  timestamp_readable|mouvement|\n+---------+-----+--------------------+---------+\n|    61624|102.2|2014-11-02 23:52:...|     true|\n|    61624|102.2|2014-11-02 23:27:...|     true|\n|    61624|102.2|2014-11-02 23:03:...|     true|\n+---------+-----+--------------------+---------+\nonly showing top 3 rows\n\n"}]},"apps":[],"jobName":"paragraph_1601895454671_1658480696","id":"20161212-235611_2060968513","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38394"},{"text":"%pyspark\n# Q12 - Créer une colonne mois pour le mois en cours\n# Astuce : Il existe une fonction month()\nspd = spd.withColumn('mois', month(spd.timestamp_readable))\n\n# Afficher les 3 premières lignes\nspd.show((3))","dateUpdated":"2020-10-05T10:57:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+-----+--------------------+---------+----+\n|id_vessel|speed|  timestamp_readable|mouvement|mois|\n+---------+-----+--------------------+---------+----+\n|    61624|102.2|2014-11-02 23:52:...|     true|  11|\n|    61624|102.2|2014-11-02 23:27:...|     true|  11|\n|    61624|102.2|2014-11-02 23:03:...|     true|  11|\n+---------+-----+--------------------+---------+----+\nonly showing top 3 rows\n\n"}]},"apps":[],"jobName":"paragraph_1601895454671_1658480696","id":"20161212-235619_945432938","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38395"},{"text":"%md\n### Maintenant un peu de SQL !\nIl est possible d'exécuter une requête sous la forme de requête sql sur un dataframe.\nPour cela, il faut d'abord enregistrer le datafarme comme une table\n`df.registerTempTable(\"maTable\")`\n\nIl suffit ensuite d'exécuter sa requête SQL en utilisant spark.sql\n`spark.sql(\"select monchamp from maTable where monAutrechamp=1\")`\n\nCe qui renvoit un nouveau Dataframe avec les résultats","dateUpdated":"2020-10-05T10:57:34+0000","config":{"editorSetting":{},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Maintenant un peu de SQL !</h3>\n<p>Il est possible d'exécuter une requête sous la forme de requête sql sur un dataframe.\n<br  />Pour cela, il faut d'abord enregistrer le datafarme comme une table\n<br  /><code>df.registerTempTable(\"maTable\")</code></p>\n<p>Il suffit ensuite d'exécuter sa requête SQL en utilisant spark.sql\n<br  /><code>spark.sql(\"select monchamp from maTable where monAutrechamp=1\")</code></p>\n<p>Ce qui renvoit un nouveau Dataframe avec les résultats</p>\n"}]},"apps":[],"jobName":"paragraph_1601895454672_1668868916","id":"20161212-235639_996256803","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38396"},{"text":"%pyspark\n# Q13 - Enregistrer la table bateaux\nbateaux.registerTempTable(\"bat\")\n\n# Q14 - Exécuter la requête suivante et affichez le résultat\n# Afficher par type, le nombre de bateaux, la vitesse max et la moyenne de la vitesse, ordonnés par nombre de bateaux\nspark.sql(\"select type, count(id_vessel) as nbBateaux , max(speed) as vmax, avg(speed) as avgspd from bat group by type order by nbBateaux desc\").show()","dateUpdated":"2020-10-05T10:57:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----+---------+-----+------------------+\n|type|nbBateaux| vmax|            avgspd|\n+----+---------+-----+------------------+\n|  70|    92939| 84.3| 4.272258540128579|\n|  30|    36652| 59.6|2.9955901856763965|\n|  80|    25513| 76.7|3.2682627402992144|\n|  52|    23430| 25.0|1.1262470359991381|\n|  79|    18032| 25.8|3.2498246590592825|\n|  37|    14927| 96.0|0.3474374495560934|\n|  60|    12553| 76.7|3.3623652453740966|\n|  90|    10208| 96.0|1.4943449104193767|\n|null|     8541| 99.7|2.2992288527701983|\n|  36|     8303| 21.9|0.7746858385693569|\n|  89|     6733| 32.1|3.8358335818669858|\n|  31|     6169| 32.1| 1.507189435930878|\n|  71|     5972|102.2| 7.691682132613467|\n|  99|     5738| 36.9|0.9869618913196897|\n|  69|     4627| 35.1|2.5557558644656826|\n|  33|     4380| 25.6| 1.177207582061951|\n|  50|     3298| 35.7| 2.193435114503817|\n|  81|     2765| 28.5|  4.25451565914057|\n|  51|     2219|102.2|0.8591594335312926|\n|  55|     2157| 38.1|0.8500000000000005|\n+----+---------+-----+------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1601895454672_1668868916","id":"20161206-104604_1824436450","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38397"},{"text":"%md\n`Exercice bonus !`\n\nDans cette suite d'exercice, réservée aux plus avertis, nous allons tenter de calculer pour un bateau, quels autres bâteaux il a pu croiser.\nLes valeurs et la méthode de calcul permettant de définir si deux bateaux se sont croisés ont été définies de façon arbitraire...\n\n**Pourquoi ne pas m'aider à améliorer cet algorithme ?**","dateUpdated":"2020-10-05T10:57:34+0000","config":{"editorSetting":{},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p><code>Exercice bonus !</code></p>\n<p>Dans cette suite d'exercice, réservée aux plus avertis, nous allons tenter de calculer pour un bateau, quels autres bâteaux il a pu croiser.\n<br  />Les valeurs et la méthode de calcul permettant de définir si deux bateaux se sont croisés ont été définies de façon arbitraire&hellip;</p>\n<p><strong>Pourquoi ne pas m'aider à améliorer cet algorithme ?</strong></p>\n"}]},"apps":[],"jobName":"paragraph_1601895454672_1668868916","id":"20161213-000155_432034499","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38398"},{"text":"%pyspark\n\n# Mettons nos compétences au service d'un cas d'usage un peu plus intéressant\n# Nous allons prendre un bateau de notre choix\n# Et nous allons tenter de calculer quels sont les bateaux qu'il a pu croiser sur sa route\n# Vous m'aiderez surement à affiner l'algorithme ... ;)\n\n# B1 - Créer un nouveau dataframe basé sur le DF bateaux et filtré uniquement sur id_vessel de votre choix\n# Débarassez vous également de la colonne \"payload\" avec la méthode df.drop(\"colonne\")\n# Cette colonne est de type bytearray, elle est lourde et nous posera des problèmes lors des reduceByKey\nbateau = bateaux.drop(bateaux.payload).filter(bateaux.id_vessel == \"28052\")\n\n# B2 - Créer un deuxième dataframe basé sur le DF bateaux, avec les colonnes id_vessel, lat, long et timestamp_pos\nreferentiel = bateaux.select(bateaux.id_vessel, bateaux.lat, bateaux.lon, bateaux.timestamp_pos)\n\n\n# On transforme nos DF en rdd grâce à la fonction rdd\nrefRDD = referentiel.rdd\nbateauRDD = bateau.rdd\n\n# On calcule le nombre d'enregistrements associés à notre bateau\nprint(bateauRDD.count())\n\n# On calcule le nombre d'enregistrements du RDD de référence\nprint(refRDD.count())\n\n\n\n","dateUpdated":"2020-10-05T10:57:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"4\n320384\n"}]},"apps":[],"jobName":"paragraph_1601895454672_1668868916","id":"20161206-111023_1294726976","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38399"},{"text":"%pyspark\n# B3 - Créer un RDD batEtude produit cartesien de notre RDD bateau et du RDD référentiel\nbatEtude = bateauRDD.cartesian(refRDD)\n\n# B3 bis - On affiche la première ligne pour analyser son contenu\n# Astuce : n'oubliez pas que l'on est maintenant sur des RDD\n#print(batEtude.take(1))\n\n# On pourrait s'amuser à compter le nombre de lignes totales du RDD.. mais c'est une action !\n# Il est possible que cela prenne un peu de temps selon la taille de votre RDD contenant un seul id_vessel\n# print(batEtude.count())\n","dateUpdated":"2020-10-05T10:57:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":[],"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1601895454673_1668484168","id":"20161212-142446_728297907","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38400"},{"text":"%pyspark\n# B4 - Filtrer notre produit cartésien pour éliminer les bateaux identiques à notre id_vessel choisi\n# Astuce : notre RDD batEtude est composé de tuples(bateau,bateauRef)\nbatEtude = batEtude.filter(lambda bateau : bateau[0].id_vessel  != bateau[1].id_vessel)\n\n","dateUpdated":"2020-10-05T10:57:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":[],"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1601895454673_1668484168","id":"20161212-144153_1836099730","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38401"},{"text":"%pyspark\n# B5 - On va également filtrer les informations des bateaux pour ne conserver que les enregistrements à +/- une heure (3600s)\nbatEtude = batEtude.filter(lambda bateau : bateau[0].timestamp_pos < bateau[1].timestamp_pos+3600000 and bateau[0].timestamp_pos > bateau[1].timestamp_pos-3600)","dateUpdated":"2020-10-05T10:57:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":[],"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1601895454673_1668484168","id":"20161213-001201_1305584982","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38402"},{"text":"%md\nNous allons importer great_circle depuis geopy.distance\nC'est une librairie python qui permet de calculer les distances entre deux coordonnées GPS\nElle fonctionne avec plusieurs méthodes dont celle du great_circle\n\nPour calculer la distance entre deux coordonnées (lat,lon) :\n`great_circle( (lat,lon) , (lat,lon) ).kilometers`","dateUpdated":"2020-10-05T10:57:34+0000","config":{"editorSetting":{},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>Nous allons importer great_circle depuis geopy.distance\n<br  />C'est une librairie python qui permet de calculer les distances entre deux coordonnées GPS\n<br  />Elle fonctionne avec plusieurs méthodes dont celle du great_circle</p>\n<p>Pour calculer la distance entre deux coordonnées (lat,lon) :\n<br  /><code>great_circle( (lat,lon) , (lat,lon) ).kilometers</code></p>\n"}]},"apps":[],"jobName":"paragraph_1601895454674_1669638414","id":"20161213-001257_515760156","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38403"},{"text":"%pyspark\n# Import de la librairie\nfrom geopy.distance import *\n\n# B6 - Filtrer notre RDD en ne conservant que les bateaux pour lesquels la distance est inférieure à 1 km\n# La méthode great_circle(lat,lon).kilometers renvoi la distance en kilomètres entre deux coordonnées\nbatEtude = batEtude.filter(lambda bateau : great_circle((bateau[0].lat,bateau[0].lon),(bateau[1].lat,bateau[1].lon)).kilometers < 1  )\n\n# Affichez la première ligne du RDD\nbatEtude.take(1)","dateUpdated":"2020-10-05T10:57:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[(Row(id_vessel=28052, mmsi=345971158, type=50, lat=18.43784, lon=-93.18951, timestamp_pos=1414971246000, speed=0.1, heading=None, timestamp_readable=datetime.datetime(2014, 11, 2, 23, 34, 6)), Row(id_vessel=23568, lat=18.435676666666666, lon=-93.18930166666667, timestamp_pos=1414970751000))]\n"}]},"apps":[],"jobName":"paragraph_1601895454674_1669638414","id":"20161212-153122_1688109304","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38404"},{"text":"%pyspark\n# Comme vous pouvez le remarquer, le résultat n'est pas vraiment lisible\n# B7 - Modifier le RDD pour obtenir pour chaque enregistrement de notre id_vessel favori, uniquement l'id_vessel du bateau de reference croisé'\nbatCroise1 = batEtude.map(lambda bateau : (bateau[0],bateau[1].id_vessel))\n\n# B8 - Réduire de sorte à concaténer l'ensemble des id_vessel croisé pour chacun des enregistrement\nbatCroise2 = batCroise1.reduceByKey(lambda x,y : str(x)+\" \"+str(y))\n\n# Puis récupérer le 1er résultat","dateUpdated":"2020-10-05T10:57:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":[],"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1601895454674_1669638414","id":"20161212-153941_619655653","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38405"},{"text":"%pyspark\n# B9 - On créer une nouveau RDD pour préparer la remise en Dataframe\n# L'objectif est de merger au sein d'une même liste tous les éléments, y compris la liste d'id_vessel du bateau de ref\nbatDistPrep = batCroise2.map(lambda bateau : (bateau[0].id_vessel, bateau[0].mmsi,  bateau[0].type,  bateau[0].lat,  bateau[0].lon,  bateau[0].timestamp_pos,   bateau[1]))\n\n# On transforme le RDD en DataFrame, et on renomme chacune des colonnes de façon appropriée\nbatDistDF = batDistPrep.toDF().withColumnRenamed('_1','id_vessel').withColumnRenamed('_2','mmsi').withColumnRenamed('_3','type').withColumnRenamed('_4','lat').withColumnRenamed('_5','lon').withColumnRenamed('_6','timestamp_pos').withColumnRenamed('_7','bateaux_croises')\nbatDistDF.show()\n\n# Et voilà le résultat\nbatDistDF.show()","dateUpdated":"2020-10-05T10:57:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{},"map":{"baseMapType":"Streets","isOnline":true,"pinCols":[]}}}],"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+---------+----+------------------+------------------+-------------+--------------------+\n|id_vessel|     mmsi|type|               lat|               lon|timestamp_pos|     bateaux_croises|\n+---------+---------+----+------------------+------------------+-------------+--------------------+\n|    28052|345971158|  50|18.437841666666667|         -93.18951|1414972068000|23568 166717 4286...|\n|    28052|345971158|  50| 18.43783833333333|-93.18950166666667|1414970417000|166717 42867 1072...|\n|    28052|345971158|  50|         18.437855|        -93.189515|1414969600000|42867 107207 5560...|\n|    28052|345971158|  50|          18.43784|         -93.18951|1414971246000|23568 166717 4286...|\n+---------+---------+----+------------------+------------------+-------------+--------------------+\n\n+---------+---------+----+------------------+------------------+-------------+--------------------+\n|id_vessel|     mmsi|type|               lat|               lon|timestamp_pos|     bateaux_croises|\n+---------+---------+----+------------------+------------------+-------------+--------------------+\n|    28052|345971158|  50|18.437841666666667|         -93.18951|1414972068000|23568 166717 4286...|\n|    28052|345971158|  50| 18.43783833333333|-93.18950166666667|1414970417000|166717 42867 1072...|\n|    28052|345971158|  50|         18.437855|        -93.189515|1414969600000|42867 107207 5560...|\n|    28052|345971158|  50|          18.43784|         -93.18951|1414971246000|23568 166717 4286...|\n+---------+---------+----+------------------+------------------+-------------+--------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1601895454674_1669638414","id":"20161212-155702_869688212","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38406"},{"text":"%pyspark\n","dateUpdated":"2020-10-05T10:57:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":[],"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1601895454674_1669638414","id":"20161212-163958_1847048831","dateCreated":"2020-10-05T10:57:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:38407"}],"name":"2 - Exercices/Exercice 3 - Exercices sur les Dataframes","id":"2FM6XM9JQ","angularObjects":{"2CHS8UYQQ:shared_process":[],"2C8A4SZ9T_livy2:shared_process":[],"2CK8A9MEG:shared_process":[],"2C4U48MY3_spark2:shared_process":[],"2CKAY1A8Y:shared_process":[],"2CKEKWY8Z:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}