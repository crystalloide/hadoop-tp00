{"paragraphs":[{"title":"1 - Markdown","text":"%md \n# Apache Zeppelin + Apache Spark + Apache Cassandra\n\nThis is a demonstration showing how to use [Apache Zeppelin notebook](https://zeppelin.incubator.apache.org/) to interact with [Apache Cassandra](http://cassandra.apache.org/) NoSQL database through [Apache Spark](http://spark.apache.org/) or directly through Cassandra CQL language.\n\n*Please note this is an unofficial demo and tutorial.*\n\n### Apache Spark\n\nApache Spark is a fast and general engine for big data processing, with built-in modules for streaming, SQL, machine learning and graph processing.\nMore details can be found here [http://spark.apache.org](http://spark.apache.org/).\nIt is  used for Cassandra data processing needs (ETL, transformations, analytics ...).\n\n### DataStax Spark Cassandra Connector\n\n[DataStax](http://www.datatstax.com) have developped a Spark Cassandra Connector to be able to read and write Cassandra data from Spark API. \nThe Spark Cassandra Connector lets you expose Cassandra tables as Spark RDDs (or DataFrames), write Spark RDDs (or DataFrames) to Cassandra tables, and execute arbitrary SQL queries from your Spark applications.\n\nUseful links:\n* [The Spark Cassandra Connector github repository](https://github.com/datastax/spark-cassandra-connector)\n* [Getting started with Apache Spark and Cassandra](https://academy.datastax.com/fr/demos/getting-started-apache-spark-and-cassandra)\n* [Free training on DataStax Enterprise Analytics with Apache Spark](https://academy.datastax.com/fr/courses/getting-started-apache-spark)\n\n### CQL Language\n\nThe Cassandra Query Language (CQL) is the primary language for communicating with the Cassandra database.\nDocumentation on CQL usage:\n* [Introduction to CQL](http://docs.datastax.com/en/cql/3.3/cql/cqlIntro.html)\n* [Using CQL](https://docs.datastax.com/en/cql/3.3/cql/cql_using/useAboutCQL.html)\n\nThe Cassandra CQL Interpreter for Apache Zeppelin is written by my colleague Duy Hai Doan  [@doanduyhai](https://twitter.com/doanduyhai)\n[CQL Interpreter documentation for Apache Zeppelin 0.5.5](https://zeppelin.incubator.apache.org/docs/0.5.5-incubating/interpreter/cassandra.html)\n\n\n","dateUpdated":"2020-10-05T10:57:12+0000","config":{"tableHide":false,"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1601895432583_-1584983180","id":"20160113-181412_1813689583","dateCreated":"2020-10-05T10:57:12+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:60328"},{"title":"2 - Shell command example","text":"%sh pwd\nls -l","dateUpdated":"2020-10-05T10:57:12+0000","config":{"tableHide":false,"colWidth":12,"editorMode":"ace/mode/sh","editorHide":true,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1601895432586_-1586137427","id":"20160113-181412_1623555306","dateCreated":"2020-10-05T10:57:12+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:60329"},{"title":"3 - Add Spark library to read CSV files","text":"%dep\n\nz.reset()\n\n// Add spark-csv package\n// Versions and documentation on https://github.com/databricks/spark-csv\nz.load(\"com.databricks:spark-csv_2.11:1.3.0\")","dateUpdated":"2020-10-05T10:57:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1601895432586_-1586137427","id":"20160113-181412_342563478","dateCreated":"2020-10-05T10:57:12+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:60330"},{"title":"4 - download demo CSV file","text":"%sh\n\n#wget https://raw.githubusercontent.com/victorcouste/zeppelin-spark-cassandra-demo/master/albums.csv\n\n# Or download direclty the demo CSV file from https://raw.githubusercontent.com/victorcouste/zeppelin-spark-cassandra-demo/master/albums.csv","dateUpdated":"2020-10-05T10:57:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/sh","editorHide":true,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1601895432586_-1586137427","id":"20160123-165554_1618215392","dateCreated":"2020-10-05T10:57:12+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:60331"},{"title":"4 - Spark :  load cSV File in dataFrame","text":"%spark\n\n//Display Spark version used\nprintln(\"Spark version:\"+sc.version)\n\nval df_albums = sqlContext.read\n.format(\"com.databricks.spark.csv\")\n.option(\"header\", \"true\")\n.load(\"albums.csv\")\n.cache\n\n//If you want to store albums.csv in a specific folder run\n//val df_albums = sqlContext.read\n//.format(\"com.databricks.spark.csv\")\n//.option(\"header\", \"true\")\n//.load(\"/your_path/albums.csv\")\n//.cache","dateUpdated":"2020-10-05T10:57:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1601895432587_-1586522176","id":"20160113-181412_829518708","dateCreated":"2020-10-05T10:57:12+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:60332"},{"title":"5 - Spark : Print Schema, Show, Filter, GroupBy dataFrame","text":"df_albums.printSchema()\ndf_albums.show()\ndf_albums.filter(\"year > 2000\").show()\ndf_albums.groupBy(\"year\").count().show()","dateUpdated":"2020-10-05T10:57:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1601895432587_-1586522176","id":"20160114-180933_599744065","dateCreated":"2020-10-05T10:57:12+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:60333"},{"title":"6 - SparkSQL on DataFrame 1","text":"df_albums.registerTempTable(\"spark_albums_table\")\n\nsqlContext.sql(\"SELECT * FROM spark_albums_table\").show","dateUpdated":"2020-10-05T10:57:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1601895432587_-1586522176","id":"20160114-002321_1001583714","dateCreated":"2020-10-05T10:57:12+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:60334"},{"title":"7 - SparkSQL On DataFrame  2","text":"%sql\nSELECT country,count(*) as nb FROM spark_albums_table group by country","dateUpdated":"2020-10-05T10:57:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/sql","editorHide":true,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[{"name":"nb","index":1,"aggr":"sum"}],"groups":[],"scatter":{"yAxis":{"name":"nb","index":1,"aggr":"sum"}}},"enabled":true,"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1601895432587_-1586522176","id":"20160114-002054_842505952","dateCreated":"2020-10-05T10:57:12+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:60335"},{"title":"8 - Cassandra CQL : Create keyspace, help and describe keyspaces","text":"%cassandra\n\nCREATE KEYSPACE IF NOT EXISTS ks_music \nWITH replication = {\n\t'class' : 'SimpleStrategy',\n\t'replication_factor' : 1\n};\n\n//help;\n\n//describe keyspaces;\n\n//describe keyspace ks_music;","dateUpdated":"2020-10-05T10:57:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1601895432588_-1588445920","id":"20160119-181849_56311459","dateCreated":"2020-10-05T10:57:12+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:60336"},{"title":"9 - Cassandra CQL : Tables creation","text":"%cassandra\n\nuse ks_music;\n\nDROP TABLE albums;\n\nCREATE TABLE IF NOT EXISTS albums ( \n\tartist text,\n\talbum text,\n\tyear text,\n\tcountry text,\n\tquality text,\n\tstatus text,\n\tPRIMARY KEY (album) \n);\n\nDROP TABLE nbalbums_by_year;\n\nCREATE TABLE IF NOT EXISTS nbalbums_by_year ( \n\tyear text,\n    nbalbums int,\n\tPRIMARY KEY (year)\n);\n\ndescribe table albums;","dateUpdated":"2020-10-05T10:57:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1601895432588_-1588445920","id":"20160113-181412_1134300065","dateCreated":"2020-10-05T10:57:12+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:60337"},{"title":"10 - Cassandra CQL","text":"%cassandra\nselect * from ks_music.albums limit 10;","dateUpdated":"2020-10-05T10:57:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1601895432588_-1588445920","id":"20160123-172739_1656103366","dateCreated":"2020-10-05T10:57:12+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:60338"},{"title":"11 - Write Spark DataFrame in Cassandra 1","text":"df_albums.write\n.format(\"org.apache.spark.sql.cassandra\")\n.option(\"header\",\"false\")\n.mode(\"append\")\n.options(Map( \"table\" -> \"albums\", \"keyspace\" -> \"ks_music\"))\n.save()","dateUpdated":"2020-10-05T10:57:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1601895432588_-1588445920","id":"20160114-001131_987960956","dateCreated":"2020-10-05T10:57:12+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:60339"},{"title":"12 - CQL Cassandra query","text":"%cassandra\nselect * from ks_music.albums limit 10;","dateUpdated":"2020-10-05T10:57:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"album","index":0,"aggr":"sum"}],"values":[{"name":"artist","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"album","index":0,"aggr":"sum"},"yAxis":{"name":"artist","index":1,"aggr":"sum"}}},"enabled":true,"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1601895432589_-1588830669","id":"20160123-172148_256698728","dateCreated":"2020-10-05T10:57:12+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:60340"},{"title":"13 - Write Spark DataFrame In Cassandra 2","text":"\nval df_nbalbyms_by_year = sqlContext.sql(\"SELECT year,count(*) as nbalbums FROM spark_albums_table group by year\")\n\ndf_nbalbyms_by_year.show\n\ndf_nbalbyms_by_year.write\n.format(\"org.apache.spark.sql.cassandra\")\n.option(\"header\",\"false\")\n.mode(\"overwrite\")\n.options(Map( \"table\" -> \"nbalbums_by_year\", \"keyspace\" -> \"ks_music\"))\n.save()","dateUpdated":"2020-10-05T10:57:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1601895432589_-1588830669","id":"20160114-000651_1120689629","dateCreated":"2020-10-05T10:57:12+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:60341"},{"title":"14 - Cassandra CQL query","text":"%cassandra\nselect * from ks_music.nbalbums_by_year;","dateUpdated":"2020-10-05T10:57:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"title":true,"results":[{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"year","index":0,"aggr":"sum"}],"values":[{"name":"nbalbums","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"year","index":0,"aggr":"sum"}}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1601895432589_-1588830669","id":"20160114-001159_1878746586","dateCreated":"2020-10-05T10:57:12+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:60342"},{"title":"15 - Spark DataFrame from Cassandra Table","text":"val df_albums_cassandra = sqlContext\n  .read\n  .format(\"org.apache.spark.sql.cassandra\")\n  .options(Map( \"table\" -> \"albums\", \"keyspace\" -> \"ks_music\" ))\n  .load()\n  \ndf_albums_cassandra.show\n","dateUpdated":"2020-10-05T10:57:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1601895432589_-1588830669","id":"20160113-182535_1195558506","dateCreated":"2020-10-05T10:57:12+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:60343"},{"title":"16 - SparkSQL table from Cassandra table","text":"%sql\nCREATE TEMPORARY TABLE table_albums\nUSING org.apache.spark.sql.cassandra\nOPTIONS ( cluster \"Test Cluster\", keyspace \"ks_music\", table \"albums\", pushdown \"true\")","dateUpdated":"2020-10-05T10:57:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/sql","editorHide":true,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"null","index":0,"aggr":"sum"}],"values":[],"groups":[],"scatter":{"xAxis":{"name":"null","index":0,"aggr":"sum"}}},"enabled":true,"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1601895432589_-1588830669","id":"20160114-002507_1756327366","dateCreated":"2020-10-05T10:57:12+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:60344"},{"title":"17 - SparkSQL query on Cassandra Data","text":"%sql\nselect country, count(*) as count from table_albums group by country having count>${albumCountThreshold=1000} order by count","dateUpdated":"2020-10-05T10:57:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/sql","editorHide":true,"title":true,"results":[{"graph":{"mode":"multiBarChart","height":196,"optionOpen":false,"keys":[{"name":"country","index":0,"aggr":"sum"}],"values":[{"name":"nb","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"country","index":0,"aggr":"sum"},"yAxis":{"name":"nb","index":1,"aggr":"sum"}}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{"albumCountThreshold":"1500"},"forms":{"albumCountThreshold":{"name":"albumCountThreshold","defaultValue":"1000","hidden":false,"$$hashKey":"object:61308"}}},"apps":[],"jobName":"paragraph_1601895432590_-1587676422","id":"20160114-181331_1246292720","dateCreated":"2020-10-05T10:57:12+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:60345"},{"dateUpdated":"2020-10-05T10:57:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1601895432590_-1587676422","id":"20160114-093455_823181330","dateCreated":"2020-10-05T10:57:12+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:60346"}],"name":"2 - Exercices/Exercice A - Spark et Cassandra","id":"2FKGK4BQ1","angularObjects":{"2CHS8UYQQ:shared_process":[],"2C8A4SZ9T_livy2:shared_process":[],"2CK8A9MEG:shared_process":[],"2C4U48MY3_spark2:shared_process":[],"2CKAY1A8Y:shared_process":[],"2CKEKWY8Z:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}